<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Assistant T√¢ches Said</title>
    <style>
        body { font-family: sans-serif; display: flex; justify-content: center; align-items: center; height: 100vh; background-color: #f0f2f5; margin: 0; }
        .container { text-align: center; background: white; padding: 40px; border-radius: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); width: 90%; max-width: 500px; }
        
        h2 { color: #333; margin-bottom: 10px; }
        p { color: #666; margin-bottom: 30px; font-weight: bold; }
        
        .btn-group {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        button { 
            color: white; 
            border: none; 
            padding: 15px 30px; 
            font-size: 18px; 
            border-radius: 50px; 
            cursor: pointer; 
            width: 100%; 
            transition: transform 0.1s;
            font-weight: bold;
        }

        button:active { transform: scale(0.98); }

        .btn-start { background-color: #007bff; }
        .btn-pause { background-color: #ffc107; color: #333; }
        .btn-resume { background-color: #28a745; }
        .btn-stop { background-color: #dc3545; }

        .controls {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        #status { margin-top: 25px; color: #666; font-style: italic; min-height: 20px;}
    </style>
</head>
<body>

<div class="container">
    <h2>Bonjour Monsieur Said</h2>
    <!-- VERSION 3 POUR V√âRIFIER LA MISE √Ä JOUR -->
    <p>Version 3 (Force Voix FR)</p>
    
    <div class="btn-group">
        <button class="btn-start" onclick="lireTaches()">üîä √âcouter mes t√¢ches</button>
        
        <div class="controls">
            <button class="btn-pause" onclick="pauseLecture()">‚è∏ Pause</button>
            <button class="btn-resume" onclick="reprendreLecture()">‚ñ∂ Reprendre</button>
            <button class="btn-stop" onclick="stopLecture()">‚èπ Stop</button>
        </div>
    </div>

    <div id="status">En attente...</div>
</div>

<script>
    // ‚ö†Ô∏è‚ö†Ô∏è COLLEZ VOTRE URL GOOGLE APPS SCRIPT ICI ‚ö†Ô∏è‚ö†Ô∏è
    const API_URL = "https://script.google.com/macros/s/AKfycbywj5xDRRDIdjK7rXFn7iz90o5MXImzwEIpjXxu2J4bQFNXqoVAgHpFxJjw2Int4sn-/exec"; 

    const synthese = window.speechSynthesis;
    let phraseEnCours = null;
    let voixDisponibles = [];

    // --- CHARGEMENT DES VOIX (IMPORTANT POUR FORCER LE FRAN√áAIS) ---
    function chargerVoix() {
        voixDisponibles = synthese.getVoices();
    }
    
    // Sur certains navigateurs, les voix ne sont pas pr√™tes tout de suite
    if (speechSynthesis.onvoiceschanged !== undefined) {
        speechSynthesis.onvoiceschanged = chargerVoix;
    }

    async function lireTaches() {
        const statusDiv = document.getElementById('status');
        
        stopLecture();
        
        // Astuce iPhone
        const unlock = new SpeechSynthesisUtterance('');
        synthese.speak(unlock);

        statusDiv.innerText = "R√©cup√©ration des t√¢ches...";
        
        try {
            const response = await fetch(API_URL);
            const data = await response.json();
            
            let texteALire = data.intro;
            
            if (data.taches.length === 0) {
                texteALire += " Vous n'avez aucune t√¢che en attente pour aujourd'hui. Profitez-en !";
            } else {
                data.taches.forEach((tache, index) => {
                    texteALire += " T√¢che num√©ro " + (index + 1) + " : " + tache + ", ";
                });
                texteALire += " Fin de la liste. Bonne journ√©e !";
            }

            statusDiv.innerText = "Lecture en cours...";
            parler(texteALire);

        } catch (error) {
            console.error(error);
            statusDiv.innerText = "Erreur de connexion.";
        }
    }

    function parler(texte) {
        synthese.cancel();

        phraseEnCours = new SpeechSynthesisUtterance(texte);
        
        // --- LOGIQUE POUR FORCER LA VOIX FRAN√áAISE ---
        // On s'assure d'avoir la liste des voix
        if (voixDisponibles.length === 0) chargerVoix();

        // On cherche une voix qui contient "fr" ou "FR" dans sa langue
        // On pr√©f√®re "Google fran√ßais" sur Android si dispo
        const voixFR = voixDisponibles.find(voice => voice.lang.includes('fr') || voice.lang.includes('FR'));
        
        if (voixFR) {
            phraseEnCours.voice = voixFR; // On force cette voix sp√©cifique
            phraseEnCours.lang = voixFR.lang;
        } else {
            // S√©curit√© si aucune voix n'est trouv√©e
            phraseEnCours.lang = 'fr-FR'; 
        }
        // ---------------------------------------------

        phraseEnCours.rate = 1; 
        phraseEnCours.pitch = 1;
        
        phraseEnCours.onend = function() {
            document.getElementById('status').innerText = "Lecture termin√©e.";
        };

        synthese.speak(phraseEnCours);
    }

    function pauseLecture() {
        if (synthese.speaking && !synthese.paused) {
            synthese.pause();
            document.getElementById('status').innerText = "Lecture en pause...";
        }
    }

    function reprendreLecture() {
        if (synthese.paused) {
            synthese.resume();
            document.getElementById('status').innerText = "Lecture en cours...";
        }
    }

    function stopLecture() {
        synthese.cancel();
        document.getElementById('status').innerText = "Lecture arr√™t√©e.";
    }
</script>

</body>
</html>
