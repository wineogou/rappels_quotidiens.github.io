<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Assistant T√¢ches Said</title>
    <style>
        body { font-family: sans-serif; display: flex; justify-content: center; align-items: center; height: 100vh; background-color: #f0f2f5; margin: 0; }
        .container { text-align: center; background: white; padding: 40px; border-radius: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); width: 90%; max-width: 500px; }
        
        h2 { color: #333; margin-bottom: 10px; }
        p { color: #666; margin-bottom: 30px; font-weight: bold; }
        
        /* Styles des boutons */
        .btn-group {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        button { 
            color: white; 
            border: none; 
            padding: 15px 30px; 
            font-size: 18px; 
            border-radius: 50px; 
            cursor: pointer; 
            width: 100%; 
            transition: transform 0.1s;
            font-weight: bold;
        }

        button:active { transform: scale(0.98); }

        /* Couleurs sp√©cifiques */
        .btn-start { background-color: #007bff; } /* Bleu */
        .btn-pause { background-color: #ffc107; color: #333; } /* Jaune */
        .btn-resume { background-color: #28a745; } /* Vert */
        .btn-stop { background-color: #dc3545; } /* Rouge */

        .controls {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        #status { margin-top: 25px; color: #666; font-style: italic; min-height: 20px;}
    </style>
</head>
<body>

<div class="container">
    <h2>Bonjour Monsieur Said</h2>
    <!-- MODIFICATION ICI POUR V√âRIFIER LA MISE A JOUR -->
    <p>Version 2</p>
    
    <div class="btn-group">
        <!-- Bouton Principal -->
        <button class="btn-start" onclick="lireTaches()">üîä √âcouter mes t√¢ches</button>
        
        <!-- Boutons de contr√¥le -->
        <div class="controls">
            <button class="btn-pause" onclick="pauseLecture()">‚è∏ Pause</button>
            <button class="btn-resume" onclick="reprendreLecture()">‚ñ∂ Reprendre</button>
            <button class="btn-stop" onclick="stopLecture()">‚èπ Stop</button>
        </div>
    </div>

    <div id="status">En attente...</div>
</div>

<script>
    // ‚ö†Ô∏è‚ö†Ô∏è COLLEZ VOTRE URL GOOGLE APPS SCRIPT ICI ‚ö†Ô∏è‚ö†Ô∏è
    const API_URL = "https://script.google.com/macros/s/AKfycbywj5xDRRDIdjK7rXFn7iz90o5MXImzwEIpjXxu2J4bQFNXqoVAgHpFxJjw2Int4sn-/exec"; 

    // Initialisation du moteur de synth√®se
    const synthese = window.speechSynthesis;
    let phraseEnCours = null;

    async function lireTaches() {
        const statusDiv = document.getElementById('status');
        
        // --- 1. ASTUCE CRUCIALE POUR IPHONE ---
        // On arr√™te tout son en cours
        stopLecture();
        // On force l'iPhone √† activer l'audio imm√©diatement avec un son vide
        // C'est n√©cessaire car l'iPhone bloque le son s'il arrive apr√®s le d√©lai du chargement (fetch)
        const unlock = new SpeechSynthesisUtterance('');
        synthese.speak(unlock);
        // -------------------------------------

        statusDiv.innerText = "R√©cup√©ration des t√¢ches...";
        
        try {
            const response = await fetch(API_URL);
            const data = await response.json();
            
            let texteALire = data.intro;
            
            if (data.taches.length === 0) {
                texteALire += " Vous n'avez aucune t√¢che en attente pour aujourd'hui. Profitez-en !";
            } else {
                data.taches.forEach((tache, index) => {
                    // Ajout d'une virgule pour une pause naturelle
                    texteALire += " T√¢che num√©ro " + (index + 1) + " : " + tache + ", ";
                });
                texteALire += " Fin de la liste. Bonne journ√©e !";
            }

            statusDiv.innerText = "Lecture en cours...";
            parler(texteALire);

        } catch (error) {
            console.error(error);
            statusDiv.innerText = "Erreur de connexion (URL?).";
        }
    }

    function parler(texte) {
        // Annulation de s√©curit√©
        synthese.cancel();

        phraseEnCours = new SpeechSynthesisUtterance(texte);
        phraseEnCours.lang = 'fr-FR'; 
        phraseEnCours.rate = 1; 
        phraseEnCours.pitch = 1;
        
        phraseEnCours.onend = function() {
            document.getElementById('status').innerText = "Lecture termin√©e.";
        };

        phraseEnCours.onerror = function(e) {
            console.error("Erreur audio:", e);
        };

        synthese.speak(phraseEnCours);
    }

    function pauseLecture() {
        // V√©rifie si √ßa parle pour mettre en pause
        if (synthese.speaking && !synthese.paused) {
            synthese.pause();
            document.getElementById('status').innerText = "Lecture en pause...";
        }
    }

    function reprendreLecture() {
        // V√©rifie si c'est en pause pour reprendre
        if (synthese.paused) {
            synthese.resume();
            document.getElementById('status').innerText = "Lecture en cours...";
        }
    }

    function stopLecture() {
        // Arr√™te tout brutalement
        synthese.cancel();
        document.getElementById('status').innerText = "Lecture arr√™t√©e.";
    }
</script>

</body>
</html>
